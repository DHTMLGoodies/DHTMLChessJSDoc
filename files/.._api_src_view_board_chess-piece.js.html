<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..&#x2F;api&#x2F;src&#x2F;view&#x2F;board&#x2F;chess-piece.js - DHTML Chess</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="http:&#x2F;&#x2F;www.dhtml-chess.com&#x2F;images&#x2F;logo.png" title="DHTML Chess"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/chess.controller.AnalysisController.html">chess.controller.AnalysisController</a></li>
            
                <li><a href="..&#x2F;classes/chess.controller.Controller.html">chess.controller.Controller</a></li>
            
                <li><a href="..&#x2F;classes/chess.controller.TacticController.html">chess.controller.TacticController</a></li>
            
                <li><a href="..&#x2F;classes/chess.dataSource.FolderTree.html">chess.dataSource.FolderTree</a></li>
            
                <li><a href="..&#x2F;classes/chess.dataSource.GameList.html">chess.dataSource.GameList</a></li>
            
                <li><a href="..&#x2F;classes/chess.model.Game.html">chess.model.Game</a></li>
            
                <li><a href="..&#x2F;classes/chess.model.Move.html">chess.model.Move</a></li>
            
                <li><a href="..&#x2F;classes/chess.parser.FenParser0x88.html">chess.parser.FenParser0x88</a></li>
            
                <li><a href="..&#x2F;classes/chess.parser.Move0x88.html">chess.parser.Move0x88</a></li>
            
                <li><a href="..&#x2F;classes/chess.parser.PositionValidator.html">chess.parser.PositionValidator</a></li>
            
                <li><a href="..&#x2F;classes/chess.remote.GameReader.html">chess.remote.GameReader</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.board.Board.html">chess.view.board.Board</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.board.GUI.html">chess.view.board.GUI</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.board.Piece.html">chess.view.board.Piece</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.dialog.Comment.html">chess.view.dialog.Comment</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.dialog.GameImport.html">chess.view.dialog.GameImport</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.dialog.NewGame.html">chess.view.dialog.NewGame</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.dialog.OverwriteMove.html">chess.view.dialog.OverwriteMove</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.dialog.Promote.html">chess.view.dialog.Promote</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.eco.VariationTree.html">chess.view.eco.VariationTree</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.folder.Tree.html">chess.view.folder.Tree</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.gamelist.Grid.html">chess.view.gamelist.Grid</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.highlight.Arrow.html">chess.view.highlight.Arrow</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.highlight.Square.html">chess.view.highlight.Square</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.installer.Installer.html">chess.view.installer.Installer</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.menuItems.GameImport.html">chess.view.menuItems.GameImport</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.menuItems.NewGame.html">chess.view.menuItems.NewGame</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.message.TacticMessage.html">chess.view.message.TacticMessage</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.metadata.FenField.html">chess.view.metadata.FenField</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.metadata.Game.html">chess.view.metadata.Game</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.metadata.Move.html">chess.view.metadata.Move</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.notation.Panel.html">chess.view.notation.Panel</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.position.Board.html">chess.view.position.Board</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.position.Castling.html">chess.view.position.Castling</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.position.Dialog.html">chess.view.position.Dialog</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.position.Pieces.html">chess.view.position.Pieces</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.position.SideToMove.html">chess.view.position.SideToMove</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.SaveGame.NewGame.html">chess.view.SaveGame.NewGame</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.Controller.html">chess.view.user.Controller</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.Country.html">chess.view.user.Country</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.LoginButton.html">chess.view.user.LoginButton</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.LoginWindow.html">chess.view.user.LoginWindow</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.LogoutButton.html">chess.view.user.LogoutButton</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.Panel.html">chess.view.user.Panel</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.ProfileWindow.html">chess.view.user.ProfileWindow</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.RegisterButton.html">chess.view.user.RegisterButton</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.RegisterWindow.html">chess.view.user.RegisterWindow</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.SettingsButton.html">chess.view.user.SettingsButton</a></li>
            
                <li><a href="..&#x2F;classes/chess.view.user.UserModel.html">chess.view.user.UserModel</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/Board.html">Board</a></li>
            
                <li><a href="..&#x2F;modules/Controller.html">Controller</a></li>
            
                <li><a href="..&#x2F;modules/DataSource.html">DataSource</a></li>
            
                <li><a href="..&#x2F;modules/Dialog.html">Dialog</a></li>
            
                <li><a href="..&#x2F;modules/Grid.html">Grid</a></li>
            
                <li><a href="..&#x2F;modules/Installer.html">Installer</a></li>
            
                <li><a href="..&#x2F;modules/Menu.html">Menu</a></li>
            
                <li><a href="..&#x2F;modules/Model.html">Model</a></li>
            
                <li><a href="..&#x2F;modules/Parser.html">Parser</a></li>
            
                <li><a href="..&#x2F;modules/Tree.html">Tree</a></li>
            
                <li><a href="..&#x2F;modules/User.html">User</a></li>
            
                <li><a href="..&#x2F;modules/View.html">View</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ..&#x2F;api&#x2F;src&#x2F;view&#x2F;board&#x2F;chess-piece.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * You will never have to use this class. Pieces are created dynamically by chess.board.Board
 * @module View
 * @submodule Board
 * @namespace chess.view.board
 * @class Piece
 * @extends Core
 *&#x2F;
ludo_CHESS_PIECE_GLOBAL_Z_INDEX = 200;
chess.view.board.Piece = new Class({
    Extends:ludo.Core,
    type:&#x27;chess.view.board.Piece&#x27;,
    color:&#x27;white&#x27;,
    type:&#x27;pawn&#x27;,
    pieceLayout:&#x27;alpha&#x27;,
    size:null,
    squareSize:null,
    validSizes:[30, 45, 60, 75, 90, 105],
    square:undefined,
    el:null,
    flipped:false,
    toSquare:null,
    Fx:null,
    board:undefined,
    ddEnabled:false,
    aniDuration:250,
    dd:{
        active:false,
        el:{ x:0, y:0},
        mouse:{x:0, y:0 }
    },
    internal:{
        files:{
            a:0, b:1, c:2, d:3, e:4, f:5, g:6, h:7
        }
    },

    validTargetSquares:[],

	ludoConfig:function (config) {
		this.parent(config);
        this.square = config.square;
        this.squareSize = config.squareSize;
        this.pieceLayout = config.pieceLayout;
        this.numSquare = config.numSquare;
        this.flipped = config.flipped;
        this.type = config.type;
        this.color = config.color;
        this.board = config.board;
        this.aniDuration = config.aniDuration || this.aniDuration;
        this.createDOM();
        this.resize(this.squareSize);
        this.position();

    },

    getEventEl:function () {
        if (Browser.ie) {
            return $(document.documentElement);
        }
        return $(window);
    },

    createDOM:function () {
        this.el = new Element(&#x27;div&#x27;);
        this.el.setStyles({
            &#x27;position&#x27;:&#x27;absolute&#x27;,
            padding:0,
            margin:0,
            borders:0,
            width:&#x27;12.5%&#x27;,
            height:&#x27;12.5%&#x27;,
            &#x27;z-index&#x27;:100,
            overflow:&#x27;hidden&#x27;
        });

        this.el.addEvent(&#x27;mouseenter&#x27;, this.mouseEnterPiece.bind(this));
        this.el.addEvent(&#x27;mouseleave&#x27;, this.mouseLeavePiece.bind(this));

        if (this.shouldUseTouchEvents()) {
            this.el.addEvent(&#x27;touchstart&#x27;, this.initDragPiece.bind(this));
            this.getEventEl().addEvent(&#x27;touchmove&#x27;, this.dragPiece.bind(this));
            this.getEventEl().addEvent(&#x27;touchend&#x27;, this.stopDragPiece.bind(this));
        } else {
            this.el.addEvent(&#x27;mousedown&#x27;, this.initDragPiece.bind(this));
            this.getEventEl().addEvent(&#x27;mousemove&#x27;, this.dragPiece.bind(this));
            this.getEventEl().addEvent(&#x27;mouseup&#x27;, this.stopDragPiece.bind(this));
        }


        this.el.addClass(&#x27;ludo-chess-piece&#x27;);
        this.position();

        this.Fx = new Fx.Morph(this.el, {
            duration:this.aniDuration * 1000,
            unit:&#x27;%&#x27;
        });
        this.Fx.addEvent(&#x27;complete&#x27;, this.animationComplete.bind(this));
    },

    mouseEnterPiece:function () {
        this.fireEvent(&#x27;mouseenter&#x27;, this)
    },

    mouseLeavePiece:function () {
        this.fireEvent(&#x27;mouseleave&#x27;, this)
    },

    disableDragAndDrop:function () {
        this.ddEnabled = false;
        this.el.style.cursor = &#x27;default&#x27;;
    },

    enableDragAndDrop:function () {
        this.ddEnabled = true;
        this.el.style.cursor = &#x27;pointer&#x27;;
    },

    isVisible:function () {
        return this.el.style.display == &#x27;none&#x27; ? false : true;
    },

    hide:function () {
        this.el.style.display = &#x27;none&#x27;;
    },

    show:function () {
        this.el.style.display = &#x27;&#x27;;
    },

    initDragPiece:function (e) {
        if (this.ddEnabled) {
            this.increaseZIndex();
            this.validTargetSquares = this.board.getValidMovesForPiece(this);
            this.fireEvent(&#x27;initdrag&#x27;, this);
            this.el.style.left = this.el.offsetLeft + &#x27;px&#x27;;
            this.el.style.top = this.el.offsetTop + &#x27;px&#x27;;
            this.dd = {
                active:true,
                mouse:{ x:e.page.x, y:e.page.y},
                el:{ x:this.el.offsetLeft, y:this.el.offsetTop }
            };
            return false;
        }
    },

    dragPiece:function (e) {
        if (this.dd.active === true) {
            this.el.style.left = (e.page.x + this.dd.el.x - this.dd.mouse.x) + &#x27;px&#x27;;
            this.el.style.top = (e.page.y + this.dd.el.y - this.dd.mouse.y) + &#x27;px&#x27;;
            return false;
        }
    },

    stopDragPiece:function (e) {
        if (this.dd.active) {
            if (this.shouldUseTouchEvents()) {
                var coords = {
                    x:e.target.offsetLeft,
                    y:e.target.offsetTop
                }
            } else {
                var coords = {
                    x:e.page.x + this.dd.el.x - this.dd.mouse.x,
                    y:e.page.y + this.dd.el.y - this.dd.mouse.y
                }
            }

            var square = this.getSquareFromCoordinates(
                coords.x,
                coords.y
            );

            if (this.validTargetSquares.indexOf(square) &gt;= 0) {
                this.position(square);
                this.fireEvent(&#x27;move&#x27;, {
                    from:Board0x88Config.numberToSquareMapping[this.square],
                    to:Board0x88Config.numberToSquareMapping[square]
                });

            } else {
                this.position();
            }
            this.dd.active = false;
        }
    },

    getSquareFromCoordinates:function (x, y) {
        x += this.squareSize &#x2F; 2;
        y += this.squareSize &#x2F; 2;

        x = Math.max(0, x);
        y = Math.max(0, y);

        x = Math.min(this.squareSize * 8, x);
        y = Math.min(this.squareSize * 8, y);

        x = Math.floor(x &#x2F; this.squareSize);
        y = Math.floor(8 - (y &#x2F; this.squareSize));
        if (this.isFlipped()) {
            x = 7 - x;
            y = 7 - y;
        }
        return x + y * 16;
    },
    getSquare:function () {
        return this.square;
    },

    promote:function (toType) {
        this.type = toType;
        this.updateBackgroundImage();
    },

    updateBackgroundImage:function () {
        this.el.setStyle(&#x27;background-image&#x27;, &#x27;url(&#x27; + chess.IMAGE_FOLDER + this.pieceLayout + this.size + this.getColorCode() + this.getTypeCode() + &#x27;.png)&#x27;);
    },

    resize:function (squareSize) {
        this.squareSize = squareSize;
        if (squareSize &lt; this.validSizes[0]) {
            squareSize = this.validSizes[0];
        }
        if (squareSize &gt; this.validSizes[this.validSizes.length - 1]) {
            squareSize = this.validSizes[this.validSizes.length - 1];
        }

        var tmpSquareSize = squareSize * 1.1;
        var pieceSize = tmpSquareSize - tmpSquareSize % 15;

        if (pieceSize != this.size) {
            this.size = pieceSize;
            this.updateBackgroundImage();
        }
    },

    position:function (square) {
        var pos = this.getPos(square);
        this.el.style.left = pos.x;
        this.el.style.top = pos.y;
    },

    playMove:function (toSquare) {

        toSquare = Board0x88Config.mapping[toSquare];

        if (this.isAllreadyOnSquare(toSquare)) {

            this.toSquare = toSquare;
            this.animationComplete();
        } else {
            var posTo = this.getPosOfSquare(toSquare);
            var posFrom = this.getPosOfSquare(this.square);

            this.increaseZIndex();

            this.Fx.start({
                &#x27;left&#x27;:[posFrom.x, posTo.x],
                &#x27;top&#x27;:[posFrom.y, posTo.y]
            });
            this.toSquare = toSquare;
        }

    },
    isAllreadyOnSquare:function (square) {
        var pos = this.getPos(square);

        if (pos.x == this.el.style.left &amp;&amp; pos.y === this.el.style.top) {
            return true;
        }
        return false;
    },
    increaseZIndex:function () {
        ludo_CHESS_PIECE_GLOBAL_Z_INDEX++;
        this.el.style.zIndex = ludo_CHESS_PIECE_GLOBAL_Z_INDEX;
    },

    animationComplete:function () {
        this.fireEvent(&#x27;animationComplete&#x27;, {
            from:this.square,
            to:this.toSquare
        });
        this.square = this.toSquare;
    },

    getPos:function (square) {
        var pos = this.getPosOfSquare(square !== undefined ? square : this.square);
        return {
            &#x27;x&#x27;:pos.x + &#x27;%&#x27;,
            &#x27;y&#x27;:pos.y + &#x27;%&#x27;
        };
    },
    getPosOfSquare:function (square) {
        var file = (square &amp; 15);
        var rank = 7 - ((square &amp; 240) &#x2F; 16)


        if (this.flipped) {
            file = 7 - file;
            rank = 7 - rank;
        }
        return {
            x:(file * 12.5),
            y:(rank * 12.5)
        }
    },

    getEl:function () {
        return this.el;
    },

    getColorCode:function () {
        return this.color == &#x27;white&#x27; ? &#x27;w&#x27; : &#x27;b&#x27;;
    },

    getTypeCode:function () {
        switch (this.type) {
            case &#x27;pawn&#x27;:
            case &#x27;rook&#x27;:
            case &#x27;bishop&#x27;:
            case &#x27;queen&#x27;:
            case &#x27;king&#x27;:
                return this.type.substr(0, 1).toLowerCase();
            case &#x27;knight&#x27;:
                return &#x27;n&#x27;;
        }
    },

    flip:function () {
        this.flipped = this.flipped ? false : true;
        this.position();
    },

    isFlipped:function () {
        return this.flipped;
    }
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
